<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/jquery-1.7.2.min.js"></script>
		<script src="../../js/jquery.lazyload.js"></script>
		<script type="text/javascript" src="../../js/lvai.data/config.js"></script>
		<script type="text/javascript" src="../../js/lvai.data/WebService2.js"></script>
		<script type="text/javascript" src="../../js/lvai.data/UserDAL.js"></script>
		<script type="text/javascript" src="../../js/lvai.base/localStorageUtils.js"></script>
		<script type="text/javascript" src="../../js/lvai.base/JsonTools.js"></script>
		
		<!--描述：地域选择 js 以及 css -->
		<script src="../../js/mui.listpicker.js"></script>
		<script src="../../js/mui.poppicker.js"></script>
		
		<link href="../../css/mui.listpicker.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			.mui-card {
				margin: 0 1.5%;
			}
			.mui-table-view li {
				/*height: 50px;*/
			}
			.mui-table-view label {
				width: 30%;
				line-height: 1.5em;
			}
			.mui-table-view input {
				width: 70%;
				height: 25px;
				margin: 0;
				padding: 0;
				text-align: right;
				border: 0;
			}
			#carImg img {
				margin-left: 3%;
			}
		</style>
		<script type="text/javascript" charset="utf-8">
			mui.init();
			 // 扩展API加载完毕后调用onPlusReady回调函数 
			document.addEventListener("plusready", onPlusReady, false);
			 // 扩展API加载完毕，现在可以正常调用扩展API 
			function onPlusReady() {
				//去除滚动条
				plus.webview.currentWebview().setStyle({
					scrollIndicator: 'none'
				});
				PageShow();
				fromInit();
			};

			function PageShow() {
				var temp = new localStorageUtils().getItem("userCar");
				var car = new JsonTools().stringToJson(temp)["data"];
				document.querySelector("#car_brand").value = car.car_brand;
				document.querySelector("#car_level>div").innerHTML = car.car_level;
				document.querySelector("#car_type").value = car.car_type;
			}
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>

			<button id="save" class="mui-btn mui-btn-link mui-btn-nav mui-pull-right">
				保存
				<span class="mui-icon mui-icon-right-nav"></span>
			</button>

			<h1 class="mui-title">车辆资料修改</h1>
		</header>

		<div class="mui-content">

			<div>
				<h5 class="mui-content-padded">车辆信息</h5>
				<div class="mui-card">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell" id="car_level">
							<span>爱车等级</span>
							<div class="mui-pull-right">100万</div> 
							<!--<input id="car_level" name="car_level" class="mui-pull-right" type="text" value="40万">-->
						</li>
						<li class="mui-table-view-cell">
							<span>品牌</span>
							<input id="car_brand" name="car_brand" class="mui-pull-right" type="text" value="宝马">
						</li>
						<li class="mui-table-view-cell">
							<span>型号</span>
							<input id="car_type" name="car_type" class="mui-pull-right" type="text" value="x7">
						</li>
						<li class="mui-table-view-cell" style="line-height: 50px;" id="carImg">
							<span>爱车靓照</span>
							<div id="loveCarPhoto">
								<div style="border: 1px dashed;">
									+
								</div>
							</div>
						</li>

					</ul>

				</div>

			</div>

			<!--<div>
				<h5 class="mui-content-padded">车辆认证
							<span style="float: right; border: 1px solid gainsboro; border-radius: 30px; font-size: 0.7em; padding: 0 8px;color: white; background-color: green" >
								已认证
							</span>
				</h5>
				<div class="mui-card">
					<ul class="mui-table-view">

						<li class="mui-table-view-cell">
							<div>
								请如下图所示上传车辆行驶证照片。
								<br />
								<ul>
									<li>证件上所有信息清晰可见。</li>
									<li>照片内容真实有效，不得任何修改。</li>
								</ul>

							</div>
							<div style="text-align: center;padding-top: 10px;">
								<img src="../../img/guide_1.jpg" width="80px" height="80px" />
								<img src="../../img/guide_2.jpg" width="80px" height="80px" />
								<button style="margin-top: 20px; width: 90%;" type="button" class="mui-btn mui-btn-blue">上传认证</button>
							</div>
						</li>
					</ul>

				</div>

			</div>-->

		</div>

	</body>
	<script>
		var width = document.querySelector("#loveCarPhoto").offsetWidth;
		document.querySelector("#loveCarPhoto div").style.width = width*0.28+"px";
		document.querySelector("#loveCarPhoto div").style.height = width*0.28+"px";
		document.querySelector("#loveCarPhoto div").style.textAlign= "center";
		document.querySelector("#loveCarPhoto div").style.lineHeight = width*0.28+"px";
		document.querySelector("#loveCarPhoto div").style.background = "#CCC";
		document.querySelector("#loveCarPhoto div").style.color = "white";
		document.querySelector("#loveCarPhoto div").style.fontSize = "3em";
		$("img.lazy").lazyload();

		function fromInit() {
			document.querySelector("#car_level").addEventListener('tap',function(){
				var car_level_select = new mui.PopPicker();
				car_level_select.setData([{
					value: '1',
					text: '20w'
				}, {
					value: '2',
					text: '50w'
				}, {
					value: '3',
					text: '100w'
				}, {
					value: '4',
					text: '200w'
				}, {
					value: '5',
					text: '500w'
				}]);
				car_level_select.show(function(items){
					document.querySelector("#car_level>div").innerHTML = items[0].text;
				},document.querySelector("#car_level>div").innerHTML);
			});
			
			document.getElementById("save").addEventListener('tap', function() {
				var userInfo = JSON.parse(new localStorageUtils().getItem("userInfo"));
				var info = {
					user_telphone: userInfo.user_telphone,
					car_level: document.querySelector("#car_level>div").innerHTML,
					car_brand: document.getElementById("car_brand").value,
					car_type: document.getElementById("car_type").value
				};
				new UserDAL().UpdateCarInfo(info, function(data) {
					//成功
					mui.toast('爱车信息更新成功！'); 
					var temp = new localStorageUtils().getItem("userCar");
					var car = new JsonTools().stringToJson(temp)["data"];
					car.car_level = info.car_level;
					car.car_brand = info.car_brand;
					car.car_type = info.car_type;
					var temp2 = new JsonTools().stringToJson(temp);
					temp2["data"] = car;
					new localStorageUtils().setItem("userCar", new JsonTools().jsonObjToString(temp2));
					
					console.log("关闭当前页面");
					mui.back();
				}, function() {
					//失败
					mui.toast('更新失败！请检查网络');
				});
			});
		}
	</script>

</html>