<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/jquery-1.7.2.min.js"></script>
		<script type="text/javascript" src="../../js/Icon.js"></script>
		<script type="text/javascript" src="../../js/lvai.data/config.js"></script>
		<script type="text/javascript" src="../../js/lvai.base/JsonTools.js"></script>
		<script type="text/javascript" src="../../js/lvai.data/WebService2.js"></script>
		<script type="text/javascript" src="../../js/lvai.data/UserDAL.js"></script>
		<script type="text/javascript" src="../../js/lvai.base/Utility.js"></script>
		<script type="text/javascript" src="../../js/lvai.base/localStorageUtils.js"></script>
		<link rel="stylesheet" href="../../css/Icon.css" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style>
			.Icon > img,
			{
				max-width: 100%;
			}
		</style>
		<script type="text/javascript" charset="utf-8">
			var Icons = null;
			var Icon = null;
			mui.init();
			 // 扩展API加载完毕后调用onPlusReady回调函数 
			document.addEventListener("plusready", onPlusReady, false);
			 // 扩展API加载完毕，现在可以正常调用扩展API 
			function onPlusReady() {
				var header_height;
				var mui_bar_height;
				var window_height;
				header_height = document.querySelector("header").offsetHeight;
				window_height = $(window).height() - header_height;
				document.querySelector(".Icon").style.maxHeight = window_height + 'px';
				Icons = plus.storage.getItem("Icon");
				console.log("图片以更换");
				document.querySelector(".Icon > img").setAttribute("src", Icons);
				Icon = $('.Icon > img').cropper({
					aspectRatio: 1 / 1,
					autoCropArea: 0.65,
					strict: true,
					guides: true,
					highlight: false,
					dragCrop: false,
					cropBoxMovable: false,
					cropBoxResizable: false
				});
				document.querySelector("#btnIcon").addEventListener('tap', function() {
					var s = new localStorageUtils().getItem("userInfo");
					var uinfo = new JsonTools().stringToJson(s);
					var base64 = Icon.cropper("getCroppedCanvas").toDataURL();
					//console.log(base64);
					var temp = base64.substr(base64.indexOf(',')+1,base64.length-base64.indexOf(','));
					//console.log(temp);
					new UserDAL().uploadHeadPhoto(
						uinfo.user_telphone,
						temp,
						function(_args) {},
						function(_args) {
							mui.toast(_args.msg)
						} //失败的函数);
					);
				});
			};
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">移动和缩放</h1>
		</header>
		<!--底部导航栏-->
		<nav class="mui-bar mui-bar-tab">
			<a id="btnIcon" class="mui-tab-item">
				<span class="mui-tab-label">确定</span>
			</a>
		</nav>
		<div class="Icon">
			<img class="img-responsive" style="visibility: hidden;" src="" alt="Picture">
		</div>
	</body>

</html>