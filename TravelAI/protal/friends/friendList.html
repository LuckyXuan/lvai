<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="../../js/mui.min.js"></script>
		
		<!--缓存图片-->
		<script type="text/javascript" src="../../js/lvai.data/md5.js" ></script>
		<script type="text/javascript" src="../../js/lvai.base/ImgTool.js" ></script>
		<!--缓存图片end-->
		
		
		<link href="../../css/mui.min.css" rel="stylesheet" />
		
		<style type="text/css">
			.list li {
				padding: 10px;
				padding-left: 3%;
			}
			
			.list img {
				border-radius: 90px;
			}
			
			.list h4 {
				font-size: 0.9em;
				line-height: 20px;
				margin: 0;
			}
			
			.info {}
		</style>
		<script type="text/javascript" charset="utf-8">
			mui.init();
			mui.plusReady(function() {
				//页面初始化
				pageInit();
				/*页面加载完成发生*/
				pageOnload();
				/*页面渲染*/
				PageRender();
				//请求网络数据以便判断一致性并渲染文字资料
				getNetData();
				
			});
			//页面初始化
			function pageInit(){
				//去除滚动挑么？
				//搜索初始化
				SearchFirendInit();
			}
			/*页面加载完成发生*/
			function pageOnload(){
				//获取本地 好友列表
				
			}
			/*页面渲染*/
			function PageRender(){
				var info = {
					phone:1,
					nickName : "李白",
					headerImgSrc : "http://img4.imgtn.bdimg.com/it/u=1024821189,4177030163&fm=21&gp=0.jpg",
					qianMing : "举头思明月,低头思故乡"
				}
				for(var i=0;i<10;i++){
					info.phone+=22;
					info.nickName += (info.phone+6);
					friendListAdd(info);
				}
				friendListHandle();
				
				
			}
			//请求网络数据以便判断一致性并渲染文字资料
			function getNetData(){}
			
			
			//动态添加   好友
			function friendListAdd(info){
				var content  = document.getElementById("tpl").content;
				var li = content.querySelector('li');
				li.id = info.phone;
				var headImg = content.querySelector(".info>img");
				headImg.setAttribute('data-src',info.headerImgSrc);//头像
				var body = content.querySelector(".mui-media-body");
				var nickname = body.querySelector('span');
				nickname.innerText = info.nickName; //昵称
				var qianM = body.querySelector("p");
				qianM.innerHTML  = info.qianMing;//签名
				var room = document.getElementById("friendRoom");
				room.appendChild(content.cloneNode(true));
			}
			
			//渲染之后给每个好友设置 事件
			function friendListHandle(){
				//先获取 所有 好友li
				var list = mui("#friendRoom>li");
				//便利
				list.each(function(key,val){
					var li = {
						index : key,
						obj : val
					};
					//添加点击事件
					this.addEventListener('tap',function(){
						var btnArray = [{
							title: "发送消息"
						}, {
							title: "查看资料"
						}];
						plus.nativeUI.actionSheet({
							cancel: "取消",
							buttons: btnArray
						}, function(e) {
							switch (e.index) {
								case 0:break;//取消
								case 1:alert(li.obj.id);break;//根据id聊天
								case 2:alert(li.obj.querySelector("img").src );break;//同上
								default:break;
							}
						});
					});
					//添加 点击左滑 菜单事件
					//<a class="mui-btn mui-btn-warning">资料</a>
					//<a class="mui-btn mui-btn-red">聊天</a>
//					this.querySelector('.mui-btn-warning').addEventListener('tap',function(e){
//						e.stopPropagation();//阻塞  父窗体响应tap事件
//						alert(li.obj.id+":"+this.innerHTML);
//					});
//					this.querySelector('.mui-btn-red').addEventListener('tap',function(e){
//						e.stopPropagation();//阻塞  父窗体响应tap事件
//						alert(li.obj.id+":"+this.innerHTML);
//					});
					
				});
			}
			
			//搜索框 的 初始化
			function SearchFirendInit(){
				var search = document.getElementById("search");
				search.oninput = function(){
					var val = this.value;
					mui("#friendRoom>li").each(function(){
						//console.log(this.querySelector("span").innerText.toString().indexOf(val));
						this.style.display = "block";
						
						if(this.querySelector("span").innerText.toString().indexOf(val)<0){
							this.style.display = "none";
							
						}
					});
					
				}
			}
			
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">旅伴列表</h1>
			<div class="mui-indexed-list-search mui-input-row mui-search">
				<input id="search" type="search" class="mui-indexed-list-search-input" placeholder="搜索好友">
			</div>
		</header>

		<div class="mui-content" style="margin-top: 40px;">
			

			<div class="list ">
				<!--mui-scroll-wrapper">-->
				<div>
					 <!--class="mui-scroll">-->
					<ul class="mui-table-view" id = "friendRoom">

						<template id="tpl">
							<li class="mui-table-view-cell">
								<div class="info ">
									<img class="mui-media-object  mui-pull-left lazy" src="../../img/head.png" data-src="" onload="lazyload(this)">
									<div class="mui-media-body">
										<span></span>
										<p class='mui-ellipsis'></p>
									</div>
								</div>
								<!--<div class="mui-slider-right mui-disabled">
									<a class="mui-btn mui-btn-warning">资料</a>
									<a class="mui-btn mui-btn-red">聊天</a>
								</div>-->
							</li>
						</template>

					</ul>

					

				</div>
			</div>
			
		</div>
		
	</body>
	<script>
		
	</script>
</html>