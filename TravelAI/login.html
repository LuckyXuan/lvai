<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/lvai.op/UIOp.js"></script>
		<script type="text/javascript" src="js/lvai.data/UserDAL.js"></script>
		<script type="text/javascript" src="js/lvai.base/Utility.js"></script>
		<script type="text/javascript" src="js/lvai.data/config.js"></script>
		<script type="text/javascript" src="js/lvai.base/JsonTools.js"></script>
		<script type="text/javascript" src="js/lvai.data/WebService2.js"></script>
		<script type="text/javascript" src="js/lvai.base/localStorageUtils.js"></script>
		<script type="text/javascript" src="js/extends/extends.js"></script>
		<script type="text/javascript" src="js/lvai.base/JsonTools.js" ></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<script type="text/javascript" charset="utf-8">
			var wt = null;
			mui.init();
			 // 扩展API加载完毕后调用onPlusReady回调函数 
			document.addEventListener("plusready", onPlusReady, false);
			 // 扩展API加载
			mui.plusReady(function() {
				//仅支持竖屏显示
				plus.screen.lockOrientation("portrait-primary");
				plus.navigator.setFullscreen(false);
			});
			 // 扩展API加载完毕，现在可以正常调用扩展API 
			function onPlusReady() {
				SetBackEvent();
				OnPreload();
				MenuInit();
				DataInit();
			};

			function MenuInit() {
				//打开主界面
				document.getElementById('btnLogin').addEventListener('tap', function() {
					
					var tel = document.getElementById("txtTel").value;
					var pwd = document.getElementById("txtPwd").value;
					if (tel == "" || pwd == "") {
						mui.toast("手机号和密码不能为空");
						return;
					}
					if (!Utility.checkPhone(tel)) {
						mui.toast("手机号输入错误");
						return;
					}
					wt = plus.nativeUI.showWaiting("登录中...");
					var dal = new UserDAL();
					dal.faildLoginHandler = function(_args) {
						mui.toast(_args);
						wt.close();
					}
					dal.successLoginHandler = function(_args) {
						//mui.toast(_args.toString())
						GetCarData(_args);
					}
					dal.login(tel, pwd);
				});
				//注册按钮
				document.getElementById('btnReg').addEventListener('tap', function() {
					mui.fire(reg, 'show', null);
					setTimeout(function() {
						mui.openWindow({
							id: 'reg',
							show: {
								aniShow: 'pop-in'
							},
							waiting: {
								autoShow: false
							}
						});
					}, 0);
				});
			};
			 //预加载
			function OnPreload() {
				reg = mui.preload({
					"id": 'reg',
					"url": 'reg.html'
				});
			};
			 //获取车辆信息
			function GetCarData(_args) {
				console.log(_args.user_telphone)
				new UserDAL().getCarInfo(_args.user_telphone, function() {
					//获取车辆成功，显示车辆信息
					mui.toast("欢迎回来： " + _args.user_nikeName);
					mui.openWindow({
						url: 'protal/main.html',
						id: 'main',
						show: {
							aniShow: 'pop-in'
						},
						waiting:{
							autoShow:false
						}
					});
					wt.close();
				}, function() {
					//获取车辆失败
					mui.toast("未能登录，请检查网络");
					wt.close();
				});
			};
			
			function DataInit() {
				var u = new localStorageUtils().getItem("userInfo");
				if(u)
				{
					var uinfo = new JsonTools().stringToJson(u);
					document.getElementById("txtTel").value = uinfo.user_telphone;
				}
			}


		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<button id="btnReg" class="mui-btn mui-btn-link mui-btn-nav mui-pull-right">
				注册
				<span class="mui-icon mui-icon-right-nav"></span>
			</button>
			<h1 class="mui-title">登录</h1>
		</header>
		<div class="mui-content">
			<div class="mui-slider-group">
				<div class="mui-slider-item mui-slider-item-duplicate">
					<img id="tupian" width="100%" src="img/login_Log.jpg">
				</div>
			</div>
			<div class="mui-card" style="margin-top: 5%; ">
				<form class="mui-input-group">
					<div class="mui-input-row">
						<label style="font-size: 14px; width: 25%; color: #666;">手机号</label>
						<input id="txtTel" type="text" style="font-size: 14px; width: 70%; " placeholder="请输入您的手机号">
					</div>
					<div class="mui-input-row">
						<label style="font-size: 14px; width: 25%; color: #666;">密　码</label>
						<input id="txtPwd" type="password" style="font-size: 14px; width: 70%; " placeholder="请输入您的密码">
					</div>
				</form>
			</div>
			<button id="btnLogin" class="mui-btn mui-btn-primary mui-btn-block" style="margin: auto; width: 50%; margin-top: 5%; ">进入旅爱</button>
		</div>
	</body>

</html>